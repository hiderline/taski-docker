FROM node:18
WORKDIR /app

COPY package.json package.json
COPY package-lock.json package-lock.json

RUN npm install

COPY . .
RUN npm run build

# Эта команда запустит встроенный сервер на Node.js, который будет раздавать
# содержимое директории /app/build на порте 8000
CMD ["npx", "-y", "http-server", "-p", "8000", "/app/build"]

# Но теперь статикой займётся Nginx, так что запускать сервер фронтенда не требуется.
# Всё, что теперь нужно от контейнера frontend, — это просто собрать свои файлы статики.
# Текущая инструкция CMD в докерфайле фронтенда уже не нужна,
# и её можно заменить на команду копирования статики в директорию /frontend_static/.

# Для переопределения инструкции CMD не обязательно изменять докерфайл
# и пересобирать образ: в docker-compose.yml в описании контейнера
# можно применить ключ command.
